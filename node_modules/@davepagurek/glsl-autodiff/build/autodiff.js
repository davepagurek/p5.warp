!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.AutoDiff=e():t.AutoDiff=e()}(self,(function(){return(()=>{"use strict";var t={888:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WithArithmetic=e.Pow=e.Div=e.Mult=e.Sum=e.Neg=void 0;const s=i(433);class n extends s.Op{definition(){return`-${this.dependsOn[0].ref()}`}derivative(t){return"-"+this.dependsOn[0].derivRef(t)}}e.Neg=n;class r extends s.Op{definition(){return this.dependsOn.map((t=>t.ref())).join("+")}derivative(t){return this.dependsOn.map((e=>e.derivRef(t))).join("+")}}e.Sum=r;class h extends s.Op{definition(){return this.dependsOn.map((t=>t.ref())).join("*")}derivative(t){const[e,i]=this.dependsOn,s=e.isConst(t),n=i.isConst(t);return s&&!n?`${e.ref()}*${i.derivRef(t)}`:!s&&n?`${i.ref()}*${e.derivRef(t)}`:`${e.ref()}*${i.derivRef(t)}+${i.ref()}*${e.derivRef(t)}`}}e.Mult=h;class d extends s.Op{definition(){return this.dependsOn.map((t=>t.ref())).join("/")}derivative(t){const[e,i]=this.dependsOn;return`(${e.derivRef(t)}*${i.ref()}-${i.derivRef(t)}*${e.ref()})/(${i.ref()}*${i.ref()})`}}e.Div=d;class a extends s.Op{definition(){return`pow(${this.dependsOn[0].ref()},${this.dependsOn[1].ref()})`}derivative(t){const[e,i]=this.dependsOn;return i.isConst()?`${i.ref()}*pow(${e.ref()},${i.ref()}-1.0)*${e.derivRef(t)}`:e.isConst()?`pow(${e.ref()},${i.ref()})*log(${e.ref()})*${i.derivRef(t)}`:`pow(${e.ref()},${i.ref()})*(${i.ref()}*(1.0/${e.ref()}*${e.derivRef(t)})+log(${e.ref()})*${i.derivRef(t)})`}}e.Pow=a,s.Op.prototype.neg=s.UserInput((function(){return new n(this.ad,this)})),s.Op.prototype.add=s.UserInput((function(...t){if(0===t.length)throw new Error(`add() called with too few arguments: ${t}`);return new r(this.ad,this,...this.ad.convertVals(t))})),s.Op.prototype.sub=s.UserInput((function(t){return this.add(this.ad.convertVal(t).neg())})),s.Op.prototype.mult=s.UserInput((function(...t){if(0===t.length)throw new Error(`mult() called with too few arguments: ${t}`);return 1===t.length?new h(this.ad,this,this.ad.convertVal(t[0])):this.mult(t[0]).mult(...t.slice(1))})),s.Op.prototype.div=s.UserInput((function(t){return new d(this.ad,this,this.ad.convertVal(t))})),s.Op.prototype.pow=s.UserInput((function(t){return new a(this.ad,this,this.ad.convertVal(t))})),s.Op.prototype.sqrt=s.UserInput((function(){return this.pow(.5)})),e.WithArithmetic=function(t){return class extends t{constructor(){super(...arguments),this.sum=s.UserInput((function(...t){if(0===t.length)throw new Error(`sum() called with too few arguments: ${t}`);{const e=this.convertVal(t[0]);return t.length>1?e.add(...t.slice(1)):e}})),this.prod=s.UserInput((function(...t){if(0===t.length)throw new Error(`prod() called with too few arguments: ${t}`);{const e=this.convertVal(t[0]);return t.length>1?e.mult(...t.slice(1)):e}})),this.sqrt=s.UserInput((function(t){return this.convertVal(t).sqrt()}))}}}},433:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Param=e.Value=e.OpLiteral=e.OrOp=e.AndOp=e.NotOp=e.GeOp=e.GtOp=e.LeOp=e.LtOp=e.NeOp=e.EqOp=e.BooleanOp=e.Op=e.UserInput=e.getStack=void 0,e.getStack=()=>{var t,e;const i=new Error;if(!i.stack)try{throw i}catch(i){if(!i.stack)return[]}const s=/:(\d+):(?:\d+)[^\d]*$/;return null!==(e=null===(t=i.stack)||void 0===t?void 0:t.toString().split(/\r\n|\n/).filter((t=>t.match(s))))&&void 0!==e?e:[]},e.UserInput=function(t){return function(...i){var s;const n=t.apply(this,i);if(n.ad.settings.debug){const t=e.getStack();n.srcLine=null!==(s=t[2])&&void 0!==s?s:""}return n}};class i{constructor(t,...e){this.usedIn=[],this.srcLine="",this.internalDerivatives=[],this.ad=t,this.id=t.getNextID(),this.dependsOn=e;for(const t of e)t.usedIn.push(this)}scalar(){return!0}size(){return 1}glslType(){return this.scalar()?"float":`vec${this.size()}`}depth(){if(this.usedIn.length>1)return 1;const t=Math.max(0,...this.dependsOn.map((t=>t.depth())))+1;return t>this.ad.settings.maxDepthPerVariable?1:t}useTempVar(){return 1===this.depth()}ref(){return this.useTempVar()?`_glslad_v${this.id}`:`(${this.definition()})`}zeroDerivative(){return"0.0"}derivRef(t){return this.isConst(t)?this.zeroDerivative():this.useTempVar()?`_glslad_dv${this.id}_d${t.safeName()}`:`(${this.derivative(t)})`}initializer(){if(this.useTempVar()){let t=`${this.glslType()} ${this.ref()}=${this.definition()};`;return this.ad.settings.debug&&this.srcLine&&(t=`\n// From ${this.srcLine}\n`+t),t+="\n",t}return""}derivInitializer(t){return this.isConst(t)||!this.useTempVar()?"":`${this.glslType()} ${this.derivRef(t)}=${this.derivative(t)};\n`}isConst(t){return this.dependsOn.every((e=>e.isConst(t)))}outputDependencies({deps:t,derivDeps:e}){var i,s;let n="";for(const i of this.dependsOn)t.has(i)||(t.add(i),n+=i.outputDependencies({deps:t,derivDeps:e}),n+=i.initializer());for(const{param:r,op:h}of this.internalDerivatives)if(!(null===(i=e.get(r))||void 0===i?void 0:i.has(h))){const i=null!==(s=e.get(r))&&void 0!==s?s:new Set;i.add(h),e.set(r,i),n+=h.outputDerivDependencies(r,{deps:t,derivDeps:e}),n+=h.derivInitializer(r)}return n}outputDerivDependencies(t,{deps:e,derivDeps:i}){var s,n,r,h;if(this.isConst())return"";let d="";for(const r of this.dependsOn)if(e.has(r)||(e.add(r),d+=r.outputDependencies({deps:e,derivDeps:i}),d+=r.initializer()),!(null===(s=i.get(t))||void 0===s?void 0:s.has(r))&&!r.isConst(t)){const s=null!==(n=i.get(t))&&void 0!==n?n:new Set;s.add(r),i.set(t,s),d+=r.outputDerivDependencies(t,{deps:e,derivDeps:i}),d+=r.derivInitializer(t)}for(const{param:t,op:s}of this.internalDerivatives)if(!(null===(r=i.get(t))||void 0===r?void 0:r.has(s))){const n=null!==(h=i.get(t))&&void 0!==h?h:new Set;n.add(s),i.set(t,n),d+=s.outputDependencies({deps:e,derivDeps:i}),d+=s.derivInitializer(t)}return d}output(t){return this.ad.output(t,this)}outputDeriv(t,e){return this.ad.outputDeriv(t,e,this)}}e.Op=i;class s extends i{definition(){return this.dependsOn.map((t=>t.ref())).join(this.operator())}derivative(){throw new Error("unimplemented")}isConst(){return!0}glslType(){return"bool"}}e.BooleanOp=s,e.EqOp=class extends s{operator(){return"=="}},e.NeOp=class extends s{operator(){return"!="}},e.LtOp=class extends s{operator(){return"<"}},e.LeOp=class extends s{operator(){return"<="}},e.GtOp=class extends s{operator(){return">"}},e.GeOp=class extends s{operator(){return">="}},e.NotOp=class extends s{operator(){return"!"}definition(){return this.operator()+this.dependsOn[0].ref()}},e.AndOp=class extends s{operator(){return"&&"}},e.OrOp=class extends s{operator(){return"||"}};class n extends i{initializer(){return""}derivInitializer(){return""}ref(){return this.definition()}derivRef(t){return this.derivative(t)}}e.OpLiteral=n,e.Value=class extends n{constructor(t,e){super(t),this.val=e}isConst(){return!0}definition(){const t=`${this.val.toFixed(4)}`;return this.val<0?`(${t})`:t}derivative(){return"0.0"}},e.Param=class extends n{constructor(t,e,...i){super(t,...i),this.name=e,this.ad.registerParam(this,e)}safeName(){return this.name.split("").map((t=>t.match(/[\w\d]/)?t:"_")).join("")+this.id}isConst(t){return!!t&&t!==this}definition(){return this.name}derivative(t){return t===this?"1.0":"0.0"}}},225:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WithFunctions=e.Abs=e.IfElse=e.Max=e.Min=e.Clamp=e.Mix=e.Cos=e.Sin=void 0;const s=i(433);class n extends s.Op{definition(){return`sin(${this.dependsOn[0].ref()})`}derivative(t){return`cos(${this.dependsOn[0].ref()})*${this.dependsOn[0].derivRef(t)}`}}e.Sin=n;class r extends s.Op{definition(){return`cos(${this.dependsOn[0].ref()})`}derivative(t){return`-sin(${this.dependsOn[0].ref()})*${this.dependsOn[0].derivRef(t)}`}}e.Cos=r;class h extends s.Op{definition(){return`mix(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i,s]=this.dependsOn;return`(1.0-${e.ref()})*${s.derivRef(t)}+(-${e.derivRef(t)})*${s.ref()}+${i.ref()}*${s.derivRef(t)}+${i.derivRef(t)}*${s.ref()}`}}e.Mix=h;class d extends s.Op{definition(){return`clamp(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i,s]=this.dependsOn;return`${e.ref()}<${i.ref()} ? 0.0 : (${e.ref()}>${s.ref()} ? 0.0 : ${e.derivRef(t)})`}}e.Clamp=d;class a extends s.Op{definition(){return`min(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i]=this.dependsOn;return`${e.ref()}<${i.ref()} ? ${e.derivRef(t)} : ${i.derivRef(t)}`}}e.Min=a;class u extends s.Op{definition(){return`max(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i]=this.dependsOn;return`${e.ref()}>${i.ref()} ? ${e.derivRef(t)} : ${i.derivRef(t)}`}}e.Max=u;class o extends s.Op{definition(){const[t,e,i]=this.dependsOn;return`${t.ref()}?${e.ref()}:${i.ref()}`}derivative(t){const[e,i,s]=this.dependsOn;return`${e.ref()}?${i.derivRef(t)}:${s.derivRef(t)}`}}e.IfElse=o;class p extends s.Op{definition(){return`abs(${this.dependsOn[0].ref()})`}derivative(t){return"0.0"}}e.Abs=p,s.Op.prototype.sin=s.UserInput((function(){return new n(this.ad,this)})),s.Op.prototype.cos=s.UserInput((function(){return new r(this.ad,this)})),s.Op.prototype.tan=s.UserInput((function(){return this.sin().div(this.cos())})),s.Op.prototype.mix=s.UserInput((function(t,e){return new h(this.ad,this,this.ad.convertVal(t),this.ad.convertVal(e))})),s.Op.prototype.clamp=s.UserInput((function(t,e){return new d(this.ad,this,this.ad.convertVal(t),this.ad.convertVal(e))})),s.Op.prototype.min=s.UserInput((function(...t){return t.reduce(((t,e)=>new a(this.ad,t,this.ad.convertVal(e))),this)})),s.Op.prototype.max=s.UserInput((function(...t){return t.reduce(((t,e)=>new u(this.ad,t,this.ad.convertVal(e))),this)})),s.Op.prototype.ifElse=s.UserInput((function(t,e){return new o(this.ad,this,this.ad.convertVal(t),this.ad.convertVal(e))})),e.WithFunctions=function(t){return class extends t{constructor(){super(...arguments),this.sin=s.UserInput((function(t){return this.convertVal(t).sin()})),this.cos=s.UserInput((function(t){return this.convertVal(t).cos()})),this.tan=s.UserInput((function(t){return this.convertVal(t).tan()})),this.mix=s.UserInput((function(t,e,i){return this.convertVal(t).mix(e,i)})),this.clamp=s.UserInput((function(t,e,i){return this.convertVal(t).clamp(e,i)})),this.min=s.UserInput((function(...t){if(0===t.length)throw new Error("No arguments passed to min()!");{const e=this.convertVal(t[0]);return t.length>1?e.min(...t.slice(1)):e}})),this.max=s.UserInput((function(...t){if(0===t.length)throw new Error("No arguments passed to min()!");{const e=this.convertVal(t[0]);return t.length>1?e.max(...t.slice(1)):e}})),this.ifElse=s.UserInput((function(t,e,i){return this.convertVal(t).ifElse(e,i)}))}}}},165:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WithVecArithmetic=e.VecMult=e.VecScale=e.VecSum=e.VecNeg=void 0;const s=i(433),n=i(789);class r extends n.WithVecDependencies{definition(){return`-${this.dependsOn[0].ref()}`}derivative(t){return"-"+this.dependsOn[0].derivRef(t)}}e.VecNeg=r;class h extends n.WithVecDependencies{definition(){return this.dependsOn.map((t=>t.ref())).join("+")}derivative(t){return this.dependsOn.map((e=>e.derivRef(t))).join("+")}}e.VecSum=h;class d extends n.WithVecDependencies{definition(){return this.dependsOn.map((t=>t.ref())).join("*")}derivative(t){const[e,i]=this.dependsOn;return`${e.ref()}*${i.derivRef(t)}+${i.ref()}*${e.derivRef(t)}`}}e.VecScale=d;class a extends n.WithVecDependencies{definition(){return this.dependsOn.map((t=>t.ref())).join("*")}derivative(t){const[e,i]=this.dependsOn;return`${e.ref()}*${i.derivRef(t)}+${i.ref()}*${e.derivRef(t)}`}}e.VecMult=a,n.VectorOp.prototype.neg=s.UserInput((function(){return new r(this.ad,this)})),n.VectorOp.prototype.add=s.UserInput((function(...t){return new h(this.ad,this,...t)})),n.VectorOp.prototype.scale=s.UserInput((function(t){return new d(this.ad,this,this.ad.convertVal(t))})),n.VectorOp.prototype.mult=s.UserInput((function(...t){if(0===t.length)throw new Error(`mult() called with too few arguments: ${t}`);return 1===t.length?new a(this.ad,this,t[0]):this.mult(t[0]).mult(...t.slice(1))})),e.WithVecArithmetic=function(t){return class extends t{constructor(){super(...arguments),this.vecSum=s.UserInput((function(...t){if(0===t.length)throw new Error("No arguments passed to vecSum()!");return 1===t.length?t[0]:t[0].add(...t.slice(1))})),this.vecProd=s.UserInput((function(...t){return t.reduce(((t,e)=>t.mult(e)))}))}}}},789:function(t,e,i){var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,h=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(t,e,i,s);else for(var d=t.length-1;d>=0;d--)(n=t[d])&&(h=(r<3?n(h):r>3?n(e,i,h):n(e,i))||h);return r>3&&h&&Object.defineProperty(e,i,h),h},n=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0}),e.WithVecBase=e.VecParam=e.Vec=e.Mat3Dot=e.OffsetJacobian=e.ScalarWithVecDependencies=e.WithVecDependencies=e.VectorOp=e.Cache=e.VecParamElementRef=e.VecElementRef=void 0;const r=i(433);class h extends r.Op{constructor(t,e,i){super(t,i),this.prop=e}definition(){return`${this.dependsOn[0].ref()}.${this.prop}`}derivative(t){return`${this.dependsOn[0].derivRef(t)}.${this.prop}`}}e.VecElementRef=h;class d extends r.Param{constructor(t,e,i){super(t,`_glslad_r${i.id}_${e}`,i),this.prop=e,this.name=`_glslad_r${i.id}_${e}`,this.ad.registerParam(this,this.name)}isConst(t){return!!t&&t!==this}definition(){return`${this.dependsOn[0].ref()}.${this.prop}`}derivative(t){return t===this?"1.0":"0.0"}}function a(t,e,i){const s=i.value,n=new Map;return i.value=function(...t){let e=n.get(this);return e||(e=s.apply(this,...t),n.set(this,e)),e},i}e.VecParamElementRef=d,e.Cache=a;class u extends r.Op{scalar(){return!1}x(){return new h(this.ad,"x",this)}y(){return new h(this.ad,"y",this)}z(){return new h(this.ad,"z",this)}w(){return new h(this.ad,"w",this)}getVecElementRef(t){if("x"===t)return this.x();if("y"===t)return this.y();if("z"===t)return this.z();if("w"===t)return this.w();throw new Error(`Can't get element ref ${t}`)}glslType(){return`vec${this.size()}`}zeroDerivative(){return`${this.glslType()}(0.0)`}u(){return this.x()}v(){return this.y()}r(){return this.x()}g(){return this.y()}b(){return this.z()}a(){return this.w()}xyzw(){return new f(this.ad,this.x(),this.y(),this.z(),this.w())}xywz(){return new f(this.ad,this.x(),this.y(),this.w(),this.z())}xzyw(){return new f(this.ad,this.x(),this.z(),this.y(),this.w())}xzwy(){return new f(this.ad,this.x(),this.z(),this.w(),this.y())}xwyz(){return new f(this.ad,this.x(),this.w(),this.y(),this.z())}xwzy(){return new f(this.ad,this.x(),this.w(),this.z(),this.y())}yxzw(){return new f(this.ad,this.y(),this.x(),this.z(),this.w())}yxwz(){return new f(this.ad,this.y(),this.x(),this.w(),this.z())}yzxw(){return new f(this.ad,this.y(),this.z(),this.x(),this.w())}yzwx(){return new f(this.ad,this.y(),this.z(),this.w(),this.x())}ywxz(){return new f(this.ad,this.y(),this.w(),this.x(),this.z())}ywzx(){return new f(this.ad,this.y(),this.w(),this.z(),this.x())}zxyw(){return new f(this.ad,this.z(),this.x(),this.y(),this.w())}zxwy(){return new f(this.ad,this.z(),this.x(),this.w(),this.y())}zyxw(){return new f(this.ad,this.z(),this.y(),this.x(),this.w())}zywx(){return new f(this.ad,this.z(),this.y(),this.w(),this.x())}zwxy(){return new f(this.ad,this.z(),this.w(),this.x(),this.y())}zwyx(){return new f(this.ad,this.z(),this.w(),this.y(),this.x())}wxyz(){return new f(this.ad,this.w(),this.x(),this.y(),this.z())}wxzy(){return new f(this.ad,this.w(),this.x(),this.z(),this.y())}wyxz(){return new f(this.ad,this.w(),this.y(),this.x(),this.z())}wyzx(){return new f(this.ad,this.w(),this.y(),this.z(),this.x())}wzxy(){return new f(this.ad,this.w(),this.z(),this.x(),this.y())}wzyx(){return new f(this.ad,this.w(),this.z(),this.y(),this.x())}xyz(){return new f(this.ad,this.x(),this.y(),this.z())}xzy(){return new f(this.ad,this.x(),this.z(),this.y())}yxz(){return new f(this.ad,this.y(),this.x(),this.z())}yzx(){return new f(this.ad,this.y(),this.z(),this.x())}zxy(){return new f(this.ad,this.z(),this.x(),this.y())}zyx(){return new f(this.ad,this.z(),this.y(),this.x())}xyw(){return new f(this.ad,this.x(),this.y(),this.w())}xwy(){return new f(this.ad,this.x(),this.w(),this.y())}yxw(){return new f(this.ad,this.y(),this.x(),this.w())}ywx(){return new f(this.ad,this.y(),this.w(),this.x())}wxy(){return new f(this.ad,this.w(),this.x(),this.y())}wyx(){return new f(this.ad,this.w(),this.y(),this.x())}xy(){return new f(this.ad,this.x(),this.y())}yx(){return new f(this.ad,this.y(),this.x())}xzw(){return new f(this.ad,this.x(),this.z(),this.w())}xwz(){return new f(this.ad,this.x(),this.w(),this.z())}zxw(){return new f(this.ad,this.z(),this.x(),this.w())}zwx(){return new f(this.ad,this.z(),this.w(),this.x())}wxz(){return new f(this.ad,this.w(),this.x(),this.z())}wzx(){return new f(this.ad,this.w(),this.z(),this.x())}xz(){return new f(this.ad,this.x(),this.z())}zx(){return new f(this.ad,this.z(),this.x())}xw(){return new f(this.ad,this.x(),this.w())}wx(){return new f(this.ad,this.w(),this.x())}yzw(){return new f(this.ad,this.y(),this.z(),this.w())}ywz(){return new f(this.ad,this.y(),this.w(),this.z())}zyw(){return new f(this.ad,this.z(),this.y(),this.w())}zwy(){return new f(this.ad,this.z(),this.w(),this.y())}wyz(){return new f(this.ad,this.w(),this.y(),this.z())}wzy(){return new f(this.ad,this.w(),this.z(),this.y())}yz(){return new f(this.ad,this.y(),this.z())}zy(){return new f(this.ad,this.z(),this.y())}yw(){return new f(this.ad,this.y(),this.w())}wy(){return new f(this.ad,this.w(),this.y())}zw(){return new f(this.ad,this.z(),this.w())}wz(){return new f(this.ad,this.w(),this.z())}rgba(){return new f(this.ad,this.r(),this.g(),this.b(),this.a())}rgab(){return new f(this.ad,this.r(),this.g(),this.a(),this.b())}rbga(){return new f(this.ad,this.r(),this.b(),this.g(),this.a())}rbag(){return new f(this.ad,this.r(),this.b(),this.a(),this.g())}ragb(){return new f(this.ad,this.r(),this.a(),this.g(),this.b())}rabg(){return new f(this.ad,this.r(),this.a(),this.b(),this.g())}grba(){return new f(this.ad,this.g(),this.r(),this.b(),this.a())}grab(){return new f(this.ad,this.g(),this.r(),this.a(),this.b())}gbra(){return new f(this.ad,this.g(),this.b(),this.r(),this.a())}gbar(){return new f(this.ad,this.g(),this.b(),this.a(),this.r())}garb(){return new f(this.ad,this.g(),this.a(),this.r(),this.b())}gabr(){return new f(this.ad,this.g(),this.a(),this.b(),this.r())}brga(){return new f(this.ad,this.b(),this.r(),this.g(),this.a())}brag(){return new f(this.ad,this.b(),this.r(),this.a(),this.g())}bgra(){return new f(this.ad,this.b(),this.g(),this.r(),this.a())}bgar(){return new f(this.ad,this.b(),this.g(),this.a(),this.r())}barg(){return new f(this.ad,this.b(),this.a(),this.r(),this.g())}bagr(){return new f(this.ad,this.b(),this.a(),this.g(),this.r())}argb(){return new f(this.ad,this.a(),this.r(),this.g(),this.b())}arbg(){return new f(this.ad,this.a(),this.r(),this.b(),this.g())}agrb(){return new f(this.ad,this.a(),this.g(),this.r(),this.b())}agbr(){return new f(this.ad,this.a(),this.g(),this.b(),this.r())}abrg(){return new f(this.ad,this.a(),this.b(),this.r(),this.g())}abgr(){return new f(this.ad,this.a(),this.b(),this.g(),this.r())}rgb(){return new f(this.ad,this.r(),this.g(),this.b())}rbg(){return new f(this.ad,this.r(),this.b(),this.g())}grb(){return new f(this.ad,this.g(),this.r(),this.b())}gbr(){return new f(this.ad,this.g(),this.b(),this.r())}brg(){return new f(this.ad,this.b(),this.r(),this.g())}bgr(){return new f(this.ad,this.b(),this.g(),this.r())}rga(){return new f(this.ad,this.r(),this.g(),this.a())}rag(){return new f(this.ad,this.r(),this.a(),this.g())}gra(){return new f(this.ad,this.g(),this.r(),this.a())}gar(){return new f(this.ad,this.g(),this.a(),this.r())}arg(){return new f(this.ad,this.a(),this.r(),this.g())}agr(){return new f(this.ad,this.a(),this.g(),this.r())}rg(){return new f(this.ad,this.r(),this.g())}gr(){return new f(this.ad,this.g(),this.r())}rba(){return new f(this.ad,this.r(),this.b(),this.a())}rab(){return new f(this.ad,this.r(),this.a(),this.b())}bra(){return new f(this.ad,this.b(),this.r(),this.a())}bar(){return new f(this.ad,this.b(),this.a(),this.r())}arb(){return new f(this.ad,this.a(),this.r(),this.b())}abr(){return new f(this.ad,this.a(),this.b(),this.r())}rb(){return new f(this.ad,this.r(),this.b())}br(){return new f(this.ad,this.b(),this.r())}ra(){return new f(this.ad,this.r(),this.a())}ar(){return new f(this.ad,this.a(),this.r())}gba(){return new f(this.ad,this.g(),this.b(),this.a())}gab(){return new f(this.ad,this.g(),this.a(),this.b())}bga(){return new f(this.ad,this.b(),this.g(),this.a())}bag(){return new f(this.ad,this.b(),this.a(),this.g())}agb(){return new f(this.ad,this.a(),this.g(),this.b())}abg(){return new f(this.ad,this.a(),this.b(),this.g())}gb(){return new f(this.ad,this.g(),this.b())}bg(){return new f(this.ad,this.b(),this.g())}ga(){return new f(this.ad,this.g(),this.a())}ag(){return new f(this.ad,this.a(),this.g())}ba(){return new f(this.ad,this.b(),this.a())}ab(){return new f(this.ad,this.a(),this.b())}uv(){return new f(this.ad,this.u(),this.v())}vu(){return new f(this.ad,this.v(),this.u())}}s([a,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",r.Op)],u.prototype,"x",null),s([a,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",r.Op)],u.prototype,"y",null),s([a,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",r.Op)],u.prototype,"z",null),s([a,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",r.Op)],u.prototype,"w",null),e.VectorOp=u;class o extends u{get vecDependsOn(){return this.dependsOn}size(){return this.vecDependsOn[0].size()}}e.WithVecDependencies=o;class p extends r.Op{get vecDependsOn(){return this.dependsOn}size(){return this.vecDependsOn[0].size()}}e.ScalarWithVecDependencies=p,e.OffsetJacobian=class extends o{constructor(t,...e){super(t,...e),this.internalDerivatives.push({op:this.offset(),param:this.position().x()},{op:this.offset(),param:this.position().y()},{op:this.offset(),param:this.position().z()});for(const{op:t}of this.internalDerivatives)t.usedIn.push(this)}size(){return 3}position(){return this.dependsOn[0]}offset(){return this.dependsOn[1]}glslType(){return"mat3"}definition(){return`mat3(${this.offset().derivRef(this.position().x())},${this.offset().derivRef(this.position().y())},${this.offset().derivRef(this.position().z())})`}derivative(t){throw new Error("Unimplemented")}dot(t){return new c(this.ad,this,t)}};class c extends u{size(){return 3}mat3(){return this.dependsOn[0]}vec3(){return this.dependsOn[1]}definition(){return`${this.mat3().ref()}*${this.vec3().ref()}`}derivative(t){throw new Error("Unimplemented")}}e.Mat3Dot=c;class f extends u{size(){return this.dependsOn.length}definition(){return`vec${this.size()}(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){return`vec${this.size()}(${this.dependsOn.map((e=>e.derivRef(t))).join(",")})`}x(){return this.dependsOn[0]}y(){return this.dependsOn[1]}z(){return this.dependsOn[2]}w(){return this.dependsOn[3]}}e.Vec=f;class l extends u{constructor(t,e,i){super(t),this.name=e,this._size=i}size(){return this._size}x(){return new d(this.ad,"x",this)}y(){return new d(this.ad,"y",this)}z(){return new d(this.ad,"z",this)}w(){return new d(this.ad,"w",this)}getElems(){return"xyzw".split("").slice(0,this.size()).map((t=>this.getVecElementRef(t)))}definition(){return this.name}derivative(t){return`vec${this.size()}(${this.getElems().map((e=>e.derivRef(t))).join(",")})`}isConst(t){return!!t&&t!==this.x()&&t!==this.y()&&t!==this.z()}initializer(){return""}ref(){return this.definition()}derivInitializer(t){return this.isConst(t)||!this.useTempVar()?"":`vec${this.size()} ${this.derivRef(t)}=${this.derivative(t)};\n`}}s([a,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],l.prototype,"x",null),s([a,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],l.prototype,"y",null),s([a,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],l.prototype,"z",null),s([a,n("design:type",Function),n("design:paramtypes",[]),n("design:returntype",void 0)],l.prototype,"w",null),e.VecParam=l,e.WithVecBase=function(t){return class extends t{constructor(){super(...arguments),this.vec2Param=r.UserInput((function(t){return new l(this,t,2)})),this.vec3Param=r.UserInput((function(t){return new l(this,t,3)})),this.vec4Param=r.UserInput((function(t){return new l(this,t,4)})),this.vec2=r.UserInput((function(t,e){return new f(this,this.convertVal(t),this.convertVal(e))})),this.vec3=r.UserInput((function(t,e,i){return new f(this,...this.convertVals([t,e,i]))})),this.vec4=r.UserInput((function(t,e,i,s){return new f(this,...this.convertVals([t,e,i,s]))}))}}}},35:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WithVecFunctions=e.Normalize=e.Cross=e.Dist=e.Length=e.Dot=e.VecAbs=e.VecNormalize=e.VecIfElse=e.VecMax=e.VecMin=e.VecClamp=e.VecMix=void 0;const s=i(433),n=i(789),r=i(165);class h extends n.WithVecDependencies{definition(){return`mix(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i,s]=this.dependsOn;return`(1.0-${e.ref()})*${s.derivRef(t)}+(-${e.derivRef(t)})*${s.ref()}+${i.ref()}*${s.derivRef(t)}+${i.derivRef(t)}*${s.ref()}`}}e.VecMix=h;class d extends n.WithVecDependencies{definition(){return`clamp(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i,s]=this.vecDependsOn.map((t=>"xyzw".split("").slice(0,t.size()).map((e=>t.getVecElementRef(e))))),n=Array(this.size()).fill(0).map(((n,r)=>{return h=e[r],d=i[r],a=s[r],`${h.ref()}<${d.ref()} ? 0.0 : (${h.ref()}>${a.ref()} ? 0.0 : ${h.derivRef(t)})`;var h,d,a})).join(",");return`vec${this.size()}(${n})`}}e.VecClamp=d;class a extends n.WithVecDependencies{definition(){return`min(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i]=this.vecDependsOn.map((t=>"xyzw".split("").slice(0,t.size()).map((e=>t.getVecElementRef(e))))),s=Array(this.size()).fill(0).map(((s,n)=>{return r=e[n],h=i[n],`${r.ref()}<${h.ref()} ? ${r.derivRef(t)} : ${h.derivRef(t)}`;var r,h})).join(",");return`vec${this.size()}(${s})`}}e.VecMin=a;class u extends n.WithVecDependencies{definition(){return`max(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i]=this.vecDependsOn.map((t=>"xyzw".split("").slice(0,t.size()).map((e=>t.getVecElementRef(e))))),s=Array(this.size()).fill(0).map(((s,n)=>{return r=e[n],h=i[n],`${r.ref()}>${h.ref()} ? ${r.derivRef(t)} : ${h.derivRef(t)}`;var r,h})).join(",");return`vec${this.size()}(${s})`}}e.VecMax=u;class o extends n.WithVecDependencies{size(){return this.vecDependsOn[1].size()}definition(){const[t,e,i]=this.dependsOn;return`${t.ref()}?${e.ref()}:${i.ref()}`}derivative(t){const[e,i,s]=this.dependsOn;return`${e.ref()}?${i.derivRef(t)}:${s.derivRef(t)}`}}e.VecIfElse=o;class p extends n.WithVecDependencies{size(){return this.vecDependsOn[0].size()}definition(){const[t]=this.dependsOn;return`normalize(${t.ref()})`}derivative(t){throw new Error("unimplemented")}}e.VecNormalize=p;class c extends n.WithVecDependencies{size(){return this.vecDependsOn[0].size()}definition(){const[t]=this.dependsOn;return`abs(${t.ref()})}`}derivative(t){return"0.0"}}e.VecAbs=c;class f extends n.ScalarWithVecDependencies{definition(){return`dot(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i]=this.vecDependsOn;return"xyzw".split("").slice(0,this.size()).map((s=>`${e.ref()}.${s}*${i.derivRef(t)}.${s}+${i.ref()}.${s}*${e.derivRef(t)}.${s}`)).join("+")}}e.Dot=f;class l extends n.ScalarWithVecDependencies{scalar(){return!0}definition(){return`length(${this.dependsOn[0].ref()})`}derivative(t){return`0.5/length(${this.dependsOn[0].ref()})*${"xyzw".split("").slice(0,this.size()).map((e=>`2.0*${this.dependsOn[0].ref()}.${e}*${this.dependsOn[0].derivRef(t)}.${e}`)).join("+")}`}}e.Length=l;class w extends n.ScalarWithVecDependencies{definition(){return`distance(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){return`0.5/distance(${this.dependsOn.map((t=>t.ref())).join(",")})*${"xyzw".split("").slice(0,this.size()).map((e=>`2.0*(${this.dependsOn.map((t=>t.ref())).join("-")}).${e}*(${this.dependsOn.map((e=>e.derivRef(t))).join("-")}).${e}`)).join("+")}`}}e.Dist=w;class v extends n.WithVecDependencies{size(){return this.vecDependsOn[0].size()}definition(){const[t,e]=this.dependsOn;return`cross(${t.ref()},${e.ref()})`}derivative(t){throw new Error("unimplemented")}}e.Cross=v;class g extends n.WithVecDependencies{size(){return this.vecDependsOn[0].size()}definition(){const[t,e]=this.dependsOn;return`normalize(${t.ref()}})`}derivative(t){throw new Error("unimplemented")}}e.Normalize=g,n.VectorOp.prototype.mix=s.UserInput((function(t,e){return new h(this.ad,this,t,this.ad.convertVal(e))})),n.VectorOp.prototype.clamp=s.UserInput((function(t,e){return new d(this.ad,this,t,e)})),n.VectorOp.prototype.min=s.UserInput((function(...t){return t.reduce(((t,e)=>new a(this.ad,t,e)),this)})),n.VectorOp.prototype.max=s.UserInput((function(...t){return t.reduce(((t,e)=>new u(this.ad,t,e)),this)})),n.VectorOp.prototype.dot=s.UserInput((function(t){return new f(this.ad,this,t)})),n.VectorOp.prototype.length=s.UserInput((function(){return new l(this.ad,this)})),n.VectorOp.prototype.dist=s.UserInput((function(t){return new w(this.ad,this,t)})),s.Op.prototype.vecIfElse=s.UserInput((function(t,e){return new o(this.ad,this,t,e)})),n.VectorOp.prototype.adjustNormal=function(t,e){const i=new n.Vec(this.ad,...this.ad.convertVals([1,0,0])),h=new n.Vec(this.ad,...this.ad.convertVals([0,1,0])),d=new s.EqOp(this.ad,t.y(),new s.Value(this.ad,0)),a=new s.EqOp(this.ad,t.z(),new s.Value(this.ad,0)),u=new s.AndOp(this.ad,d,a).vecIfElse(h,i),o=new p(this.ad,new v(this.ad,u,t)),c=new v(this.ad,o,t),f=new n.OffsetJacobian(this.ad,e,this),l=new r.VecMult(this.ad,f,c),w=new r.VecMult(this.ad,f,o);return new p(this.ad,new v(this.ad,new r.VecSum(this.ad,c,l),new r.VecSum(this.ad,o,w)))},e.WithVecFunctions=function(t){return class extends t{constructor(){super(...arguments),this.vecMix=s.UserInput((function(t,e,i){return t.mix(e,i)})),this.vecClamp=s.UserInput((function(t,e,i){return t.clamp(e,i)})),this.vecMin=s.UserInput((function(...t){if(0===t.length)throw new Error("No arguments passed to vecMin()!");return t.reduce(((t,e)=>t.min(e)))})),this.vecMax=s.UserInput((function(...t){if(0===t.length)throw new Error("No arguments passed to vecMax()!");return t.reduce(((t,e)=>t.max(e)))})),this.dot=s.UserInput((function(t,e){return t.dot(e)})),this.length=s.UserInput((function(t){return t.length()})),this.dist=s.UserInput((function(t,e){return t.dist(e)}))}}}}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={exports:{}};return t[s].call(r.exports,r,r.exports,i),r.exports}var s={};return(()=>{var t=s;Object.defineProperty(t,"__esModule",{value:!0}),t.gen=void 0;const e=i(433),n=i(888),r=i(225),h=i(789),d=i(165),a=i(35).WithVecFunctions(d.WithVecArithmetic(h.WithVecBase(r.WithFunctions(n.WithArithmetic(class{constructor(){this.nextID=0,this.settings={maxDepthPerVariable:8,debug:!1},this.params={},this.outputs={},this.derivOutputs={},this.val=e.UserInput((function(t){return new e.Value(this,t)})),this.param=e.UserInput((function(t){return new e.Param(this,t)}))}getNextID(){const t=this.nextID;return this.nextID++,t}registerParam(t,e){this.params[e]=t}convertVal(t){return t instanceof e.Op?t:this.val(t)}convertVals(t){return t.map((t=>this.convertVal(t)))}output(t,e){return this.outputs[t]=e,this}outputDeriv(t,e,i){const s="string"==typeof e?e:e.name;return this.derivOutputs[s]=this.derivOutputs[s]||{},this.derivOutputs[s][t]=i,this}gen(){var t;let e="";const i=new Set,s=new Map;for(const t in this.outputs)e+=this.outputs[t].outputDependencies({deps:i,derivDeps:s}),e+=this.outputs[t].initializer(),i.add(this.outputs[t]),e+=`${this.outputs[t].glslType()} ${t}=${this.outputs[t].ref()};\n`;for(const n in this.derivOutputs){const r=this.params[n];for(const h in this.derivOutputs[n]){e+=this.derivOutputs[n][h].outputDerivDependencies(r,{deps:i,derivDeps:s}),e+=this.derivOutputs[n][h].derivInitializer(r),e+=`${this.derivOutputs[n][h].glslType()} ${h}=${this.derivOutputs[n][h].derivRef(r)};\n`;const d=null!==(t=s.get(r))&&void 0!==t?t:new Set;d.add(this.derivOutputs[n][h]),s.set(r,d)}}return e}})))));t.gen=(t,e={})=>{const i=new a;for(const t in e)i.settings[t]=e[t];return t(i),i.gen()}})(),s})()}));