!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.P5Warp=e():t.P5Warp=e()}(self,(()=>{return t={715:t=>{self,t.exports=(()=>{"use strict";var t={888:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WithArithmetic=e.Pow=e.Div=e.Mult=e.Sum=e.Neg=void 0;const n=i(433);class r extends n.Op{definition(){return`-${this.dependsOn[0].ref()}`}derivative(t){return"-"+this.dependsOn[0].derivRef(t)}}e.Neg=r;class s extends n.Op{definition(){return this.dependsOn.map((t=>t.ref())).join("+")}derivative(t){return this.dependsOn.map((e=>e.derivRef(t))).join("+")}}e.Sum=s;class o extends n.Op{definition(){return this.dependsOn.map((t=>t.ref())).join("*")}derivative(t){const[e,i]=this.dependsOn,n=e.isConst(t),r=i.isConst(t);return n&&!r?`${e.ref()}*${i.derivRef(t)}`:!n&&r?`${i.ref()}*${e.derivRef(t)}`:`${e.ref()}*${i.derivRef(t)}+${i.ref()}*${e.derivRef(t)}`}}e.Mult=o;class a extends n.Op{definition(){return this.dependsOn.map((t=>t.ref())).join("/")}derivative(t){const[e,i]=this.dependsOn;return`(${e.derivRef(t)}*${i.ref()}-${i.derivRef(t)}*${e.ref()})/(${i.ref()}*${i.ref()})`}}e.Div=a;class h extends n.Op{definition(){return`pow(${this.dependsOn[0].ref()},${this.dependsOn[1].ref()})`}derivative(t){const[e,i]=this.dependsOn;return i.isConst()?`${i.ref()}*pow(${e.ref()},${i.ref()}-1.0)*${e.derivRef(t)}`:e.isConst()?`pow(${e.ref()},${i.ref()})*log(${e.ref()})*${i.derivRef(t)}`:`pow(${e.ref()},${i.ref()})*(${i.ref()}*(1.0/${e.ref()}*${e.derivRef(t)})+log(${e.ref()})*${i.derivRef(t)})`}}e.Pow=h,n.Op.prototype.neg=n.UserInput((function(){return new r(this.ad,this)})),n.Op.prototype.add=n.UserInput((function(...t){if(0===t.length)throw new Error(`add() called with too few arguments: ${t}`);return new s(this.ad,this,...this.ad.convertVals(t))})),n.Op.prototype.sub=n.UserInput((function(t){return this.add(this.ad.convertVal(t).neg())})),n.Op.prototype.mult=n.UserInput((function(...t){if(0===t.length)throw new Error(`mult() called with too few arguments: ${t}`);return 1===t.length?new o(this.ad,this,this.ad.convertVal(t[0])):this.mult(t[0]).mult(...t.slice(1))})),n.Op.prototype.div=n.UserInput((function(t){return new a(this.ad,this,this.ad.convertVal(t))})),n.Op.prototype.pow=n.UserInput((function(t){return new h(this.ad,this,this.ad.convertVal(t))})),n.Op.prototype.sqrt=n.UserInput((function(){return this.pow(.5)})),e.WithArithmetic=function(t){return class extends t{constructor(){super(...arguments),this.sum=n.UserInput((function(...t){if(0===t.length)throw new Error(`sum() called with too few arguments: ${t}`);{const e=this.convertVal(t[0]);return t.length>1?e.add(...t.slice(1)):e}})),this.prod=n.UserInput((function(...t){if(0===t.length)throw new Error(`prod() called with too few arguments: ${t}`);{const e=this.convertVal(t[0]);return t.length>1?e.mult(...t.slice(1)):e}})),this.sqrt=n.UserInput((function(t){return this.convertVal(t).sqrt()}))}}}},433:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Param=e.Value=e.OpLiteral=e.OrOp=e.AndOp=e.NotOp=e.GeOp=e.GtOp=e.LeOp=e.LtOp=e.NeOp=e.EqOp=e.BooleanOp=e.Op=e.UserInput=e.getStack=void 0,e.getStack=()=>{var t,e;const i=new Error;if(!i.stack)try{throw i}catch(i){if(!i.stack)return[]}const n=/:(\d+):(?:\d+)[^\d]*$/;return null!==(e=null===(t=i.stack)||void 0===t?void 0:t.toString().split(/\r\n|\n/).filter((t=>t.match(n))))&&void 0!==e?e:[]},e.UserInput=function(t){return function(...i){var n;const r=t.apply(this,i);if(r.ad.settings.debug){const t=e.getStack();r.srcLine=null!==(n=t[2])&&void 0!==n?n:""}return r}};class i{constructor(t,...e){this.usedIn=[],this.srcLine="",this.internalDerivatives=[],this.ad=t,this.id=t.getNextID(),this.dependsOn=e;for(const t of e)t.usedIn.push(this)}scalar(){return!0}size(){return 1}glslType(){return this.scalar()?"float":`vec${this.size()}`}depth(){if(this.usedIn.length>1)return 1;const t=Math.max(0,...this.dependsOn.map((t=>t.depth())))+1;return t>this.ad.settings.maxDepthPerVariable?1:t}useTempVar(){return 1===this.depth()}ref(){return this.useTempVar()?`_glslad_v${this.id}`:`(${this.definition()})`}zeroDerivative(){return"0.0"}derivRef(t){return this.isConst(t)?this.zeroDerivative():this.useTempVar()?`_glslad_dv${this.id}_d${t.safeName()}`:`(${this.derivative(t)})`}initializer(){if(this.useTempVar()){let t=`${this.glslType()} ${this.ref()}=${this.definition()};`;return this.ad.settings.debug&&this.srcLine&&(t=`\n// From ${this.srcLine}\n`+t),t+="\n",t}return""}derivInitializer(t){return this.isConst(t)||!this.useTempVar()?"":`${this.glslType()} ${this.derivRef(t)}=${this.derivative(t)};\n`}isConst(t){return this.dependsOn.every((e=>e.isConst(t)))}outputDependencies({deps:t,derivDeps:e}){var i,n;let r="";for(const i of this.dependsOn)t.has(i)||(t.add(i),r+=i.outputDependencies({deps:t,derivDeps:e}),r+=i.initializer());for(const{param:s,op:o}of this.internalDerivatives)if(!(null===(i=e.get(s))||void 0===i?void 0:i.has(o))){const i=null!==(n=e.get(s))&&void 0!==n?n:new Set;i.add(o),e.set(s,i),r+=o.outputDerivDependencies(s,{deps:t,derivDeps:e}),r+=o.derivInitializer(s)}return r}outputDerivDependencies(t,{deps:e,derivDeps:i}){var n,r,s,o;if(this.isConst())return"";let a="";for(const s of this.dependsOn)if(e.has(s)||(e.add(s),a+=s.outputDependencies({deps:e,derivDeps:i}),a+=s.initializer()),!(null===(n=i.get(t))||void 0===n?void 0:n.has(s))&&!s.isConst(t)){const n=null!==(r=i.get(t))&&void 0!==r?r:new Set;n.add(s),i.set(t,n),a+=s.outputDerivDependencies(t,{deps:e,derivDeps:i}),a+=s.derivInitializer(t)}for(const{param:t,op:n}of this.internalDerivatives)if(!(null===(s=i.get(t))||void 0===s?void 0:s.has(n))){const r=null!==(o=i.get(t))&&void 0!==o?o:new Set;r.add(n),i.set(t,r),a+=n.outputDependencies({deps:e,derivDeps:i}),a+=n.derivInitializer(t)}return a}output(t){return this.ad.output(t,this)}outputDeriv(t,e){return this.ad.outputDeriv(t,e,this)}}e.Op=i;class n extends i{definition(){return this.dependsOn.map((t=>t.ref())).join(this.operator())}derivative(){throw new Error("unimplemented")}isConst(){return!0}glslType(){return"bool"}}e.BooleanOp=n,e.EqOp=class extends n{operator(){return"=="}},e.NeOp=class extends n{operator(){return"!="}},e.LtOp=class extends n{operator(){return"<"}},e.LeOp=class extends n{operator(){return"<="}},e.GtOp=class extends n{operator(){return">"}},e.GeOp=class extends n{operator(){return">="}},e.NotOp=class extends n{operator(){return"!"}definition(){return this.operator()+this.dependsOn[0].ref()}},e.AndOp=class extends n{operator(){return"&&"}},e.OrOp=class extends n{operator(){return"||"}};class r extends i{initializer(){return""}derivInitializer(){return""}ref(){return this.definition()}derivRef(t){return this.derivative(t)}}e.OpLiteral=r,e.Value=class extends r{constructor(t,e){super(t),this.val=e}isConst(){return!0}definition(){const t=`${this.val.toFixed(4)}`;return this.val<0?`(${t})`:t}derivative(){return"0.0"}},e.Param=class extends r{constructor(t,e,...i){super(t,...i),this.name=e,this.ad.registerParam(this,e)}safeName(){return this.name.split("").map((t=>t.match(/[\w\d]/)?t:"_")).join("")+this.id}isConst(t){return!!t&&t!==this}definition(){return this.name}derivative(t){return t===this?"1.0":"0.0"}}},225:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WithFunctions=e.Abs=e.IfElse=e.Max=e.Min=e.Clamp=e.Mix=e.Cos=e.Sin=void 0;const n=i(433);class r extends n.Op{definition(){return`sin(${this.dependsOn[0].ref()})`}derivative(t){return`cos(${this.dependsOn[0].ref()})*${this.dependsOn[0].derivRef(t)}`}}e.Sin=r;class s extends n.Op{definition(){return`cos(${this.dependsOn[0].ref()})`}derivative(t){return`-sin(${this.dependsOn[0].ref()})*${this.dependsOn[0].derivRef(t)}`}}e.Cos=s;class o extends n.Op{definition(){return`mix(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i,n]=this.dependsOn;return`(1.0-${e.ref()})*${n.derivRef(t)}+(-${e.derivRef(t)})*${n.ref()}+${i.ref()}*${n.derivRef(t)}+${i.derivRef(t)}*${n.ref()}`}}e.Mix=o;class a extends n.Op{definition(){return`clamp(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i,n]=this.dependsOn;return`${e.ref()}<${i.ref()} ? 0.0 : (${e.ref()}>${n.ref()} ? 0.0 : ${e.derivRef(t)})`}}e.Clamp=a;class h extends n.Op{definition(){return`min(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i]=this.dependsOn;return`${e.ref()}<${i.ref()} ? ${e.derivRef(t)} : ${i.derivRef(t)}`}}e.Min=h;class u extends n.Op{definition(){return`max(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i]=this.dependsOn;return`${e.ref()}>${i.ref()} ? ${e.derivRef(t)} : ${i.derivRef(t)}`}}e.Max=u;class d extends n.Op{definition(){const[t,e,i]=this.dependsOn;return`${t.ref()}?${e.ref()}:${i.ref()}`}derivative(t){const[e,i,n]=this.dependsOn;return`${e.ref()}?${i.derivRef(t)}:${n.derivRef(t)}`}}e.IfElse=d;class l extends n.Op{definition(){return`abs(${this.dependsOn[0].ref()})`}derivative(t){return"0.0"}}e.Abs=l,n.Op.prototype.sin=n.UserInput((function(){return new r(this.ad,this)})),n.Op.prototype.cos=n.UserInput((function(){return new s(this.ad,this)})),n.Op.prototype.tan=n.UserInput((function(){return this.sin().div(this.cos())})),n.Op.prototype.mix=n.UserInput((function(t,e){return new o(this.ad,this,this.ad.convertVal(t),this.ad.convertVal(e))})),n.Op.prototype.clamp=n.UserInput((function(t,e){return new a(this.ad,this,this.ad.convertVal(t),this.ad.convertVal(e))})),n.Op.prototype.min=n.UserInput((function(...t){return t.reduce(((t,e)=>new h(this.ad,t,this.ad.convertVal(e))),this)})),n.Op.prototype.max=n.UserInput((function(...t){return t.reduce(((t,e)=>new u(this.ad,t,this.ad.convertVal(e))),this)})),n.Op.prototype.ifElse=n.UserInput((function(t,e){return new d(this.ad,this,this.ad.convertVal(t),this.ad.convertVal(e))})),e.WithFunctions=function(t){return class extends t{constructor(){super(...arguments),this.sin=n.UserInput((function(t){return this.convertVal(t).sin()})),this.cos=n.UserInput((function(t){return this.convertVal(t).cos()})),this.tan=n.UserInput((function(t){return this.convertVal(t).tan()})),this.mix=n.UserInput((function(t,e,i){return this.convertVal(t).mix(e,i)})),this.clamp=n.UserInput((function(t,e,i){return this.convertVal(t).clamp(e,i)})),this.min=n.UserInput((function(...t){if(0===t.length)throw new Error("No arguments passed to min()!");{const e=this.convertVal(t[0]);return t.length>1?e.min(...t.slice(1)):e}})),this.max=n.UserInput((function(...t){if(0===t.length)throw new Error("No arguments passed to min()!");{const e=this.convertVal(t[0]);return t.length>1?e.max(...t.slice(1)):e}})),this.ifElse=n.UserInput((function(t,e,i){return this.convertVal(t).ifElse(e,i)}))}}}},165:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WithVecArithmetic=e.VecMult=e.VecScale=e.VecSum=e.VecNeg=void 0;const n=i(433),r=i(789);class s extends r.WithVecDependencies{definition(){return`-${this.dependsOn[0].ref()}`}derivative(t){return"-"+this.dependsOn[0].derivRef(t)}}e.VecNeg=s;class o extends r.WithVecDependencies{definition(){return this.dependsOn.map((t=>t.ref())).join("+")}derivative(t){return this.dependsOn.map((e=>e.derivRef(t))).join("+")}}e.VecSum=o;class a extends r.WithVecDependencies{definition(){return this.dependsOn.map((t=>t.ref())).join("*")}derivative(t){const[e,i]=this.dependsOn;return`${e.ref()}*${i.derivRef(t)}+${i.ref()}*${e.derivRef(t)}`}}e.VecScale=a;class h extends r.WithVecDependencies{definition(){return this.dependsOn.map((t=>t.ref())).join("*")}derivative(t){const[e,i]=this.dependsOn;return`${e.ref()}*${i.derivRef(t)}+${i.ref()}*${e.derivRef(t)}`}}e.VecMult=h,r.VectorOp.prototype.neg=n.UserInput((function(){return new s(this.ad,this)})),r.VectorOp.prototype.add=n.UserInput((function(...t){return new o(this.ad,this,...t)})),r.VectorOp.prototype.scale=n.UserInput((function(t){return new a(this.ad,this,this.ad.convertVal(t))})),r.VectorOp.prototype.mult=n.UserInput((function(...t){if(0===t.length)throw new Error(`mult() called with too few arguments: ${t}`);return 1===t.length?new h(this.ad,this,t[0]):this.mult(t[0]).mult(...t.slice(1))})),e.WithVecArithmetic=function(t){return class extends t{constructor(){super(...arguments),this.vecSum=n.UserInput((function(...t){if(0===t.length)throw new Error("No arguments passed to vecSum()!");return 1===t.length?t[0]:t[0].add(...t.slice(1))})),this.vecProd=n.UserInput((function(...t){return t.reduce(((t,e)=>t.mult(e)))}))}}}},789:function(t,e,i){var n=this&&this.__decorate||function(t,e,i,n){var r,s=arguments.length,o=s<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(s<3?r(o):s>3?r(e,i,o):r(e,i))||o);return s>3&&o&&Object.defineProperty(e,i,o),o},r=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(e,"__esModule",{value:!0}),e.WithVecBase=e.VecParam=e.Vec=e.Mat3Dot=e.OffsetJacobian=e.ScalarWithVecDependencies=e.WithVecDependencies=e.VectorOp=e.Cache=e.VecParamElementRef=e.VecElementRef=void 0;const s=i(433);class o extends s.Op{constructor(t,e,i){super(t,i),this.prop=e}definition(){return`${this.dependsOn[0].ref()}.${this.prop}`}derivative(t){return`${this.dependsOn[0].derivRef(t)}.${this.prop}`}}e.VecElementRef=o;class a extends s.Param{constructor(t,e,i){super(t,`_glslad_r${i.id}_${e}`,i),this.prop=e,this.name=`_glslad_r${i.id}_${e}`,this.ad.registerParam(this,this.name)}isConst(t){return!!t&&t!==this}definition(){return`${this.dependsOn[0].ref()}.${this.prop}`}derivative(t){return t===this?"1.0":"0.0"}}function h(t,e,i){const n=i.value,r=new Map;return i.value=function(...t){let e=r.get(this);return e||(e=n.apply(this,...t),r.set(this,e)),e},i}e.VecParamElementRef=a,e.Cache=h;class u extends s.Op{scalar(){return!1}x(){return new o(this.ad,"x",this)}y(){return new o(this.ad,"y",this)}z(){return new o(this.ad,"z",this)}w(){return new o(this.ad,"w",this)}getVecElementRef(t){if("x"===t)return this.x();if("y"===t)return this.y();if("z"===t)return this.z();if("w"===t)return this.w();throw new Error(`Can't get element ref ${t}`)}glslType(){return`vec${this.size()}`}zeroDerivative(){return`${this.glslType()}(0.0)`}u(){return this.x()}v(){return this.y()}r(){return this.x()}g(){return this.y()}b(){return this.z()}a(){return this.w()}xyzw(){return new p(this.ad,this.x(),this.y(),this.z(),this.w())}xywz(){return new p(this.ad,this.x(),this.y(),this.w(),this.z())}xzyw(){return new p(this.ad,this.x(),this.z(),this.y(),this.w())}xzwy(){return new p(this.ad,this.x(),this.z(),this.w(),this.y())}xwyz(){return new p(this.ad,this.x(),this.w(),this.y(),this.z())}xwzy(){return new p(this.ad,this.x(),this.w(),this.z(),this.y())}yxzw(){return new p(this.ad,this.y(),this.x(),this.z(),this.w())}yxwz(){return new p(this.ad,this.y(),this.x(),this.w(),this.z())}yzxw(){return new p(this.ad,this.y(),this.z(),this.x(),this.w())}yzwx(){return new p(this.ad,this.y(),this.z(),this.w(),this.x())}ywxz(){return new p(this.ad,this.y(),this.w(),this.x(),this.z())}ywzx(){return new p(this.ad,this.y(),this.w(),this.z(),this.x())}zxyw(){return new p(this.ad,this.z(),this.x(),this.y(),this.w())}zxwy(){return new p(this.ad,this.z(),this.x(),this.w(),this.y())}zyxw(){return new p(this.ad,this.z(),this.y(),this.x(),this.w())}zywx(){return new p(this.ad,this.z(),this.y(),this.w(),this.x())}zwxy(){return new p(this.ad,this.z(),this.w(),this.x(),this.y())}zwyx(){return new p(this.ad,this.z(),this.w(),this.y(),this.x())}wxyz(){return new p(this.ad,this.w(),this.x(),this.y(),this.z())}wxzy(){return new p(this.ad,this.w(),this.x(),this.z(),this.y())}wyxz(){return new p(this.ad,this.w(),this.y(),this.x(),this.z())}wyzx(){return new p(this.ad,this.w(),this.y(),this.z(),this.x())}wzxy(){return new p(this.ad,this.w(),this.z(),this.x(),this.y())}wzyx(){return new p(this.ad,this.w(),this.z(),this.y(),this.x())}xyz(){return new p(this.ad,this.x(),this.y(),this.z())}xzy(){return new p(this.ad,this.x(),this.z(),this.y())}yxz(){return new p(this.ad,this.y(),this.x(),this.z())}yzx(){return new p(this.ad,this.y(),this.z(),this.x())}zxy(){return new p(this.ad,this.z(),this.x(),this.y())}zyx(){return new p(this.ad,this.z(),this.y(),this.x())}xyw(){return new p(this.ad,this.x(),this.y(),this.w())}xwy(){return new p(this.ad,this.x(),this.w(),this.y())}yxw(){return new p(this.ad,this.y(),this.x(),this.w())}ywx(){return new p(this.ad,this.y(),this.w(),this.x())}wxy(){return new p(this.ad,this.w(),this.x(),this.y())}wyx(){return new p(this.ad,this.w(),this.y(),this.x())}xy(){return new p(this.ad,this.x(),this.y())}yx(){return new p(this.ad,this.y(),this.x())}xzw(){return new p(this.ad,this.x(),this.z(),this.w())}xwz(){return new p(this.ad,this.x(),this.w(),this.z())}zxw(){return new p(this.ad,this.z(),this.x(),this.w())}zwx(){return new p(this.ad,this.z(),this.w(),this.x())}wxz(){return new p(this.ad,this.w(),this.x(),this.z())}wzx(){return new p(this.ad,this.w(),this.z(),this.x())}xz(){return new p(this.ad,this.x(),this.z())}zx(){return new p(this.ad,this.z(),this.x())}xw(){return new p(this.ad,this.x(),this.w())}wx(){return new p(this.ad,this.w(),this.x())}yzw(){return new p(this.ad,this.y(),this.z(),this.w())}ywz(){return new p(this.ad,this.y(),this.w(),this.z())}zyw(){return new p(this.ad,this.z(),this.y(),this.w())}zwy(){return new p(this.ad,this.z(),this.w(),this.y())}wyz(){return new p(this.ad,this.w(),this.y(),this.z())}wzy(){return new p(this.ad,this.w(),this.z(),this.y())}yz(){return new p(this.ad,this.y(),this.z())}zy(){return new p(this.ad,this.z(),this.y())}yw(){return new p(this.ad,this.y(),this.w())}wy(){return new p(this.ad,this.w(),this.y())}zw(){return new p(this.ad,this.z(),this.w())}wz(){return new p(this.ad,this.w(),this.z())}rgba(){return new p(this.ad,this.r(),this.g(),this.b(),this.a())}rgab(){return new p(this.ad,this.r(),this.g(),this.a(),this.b())}rbga(){return new p(this.ad,this.r(),this.b(),this.g(),this.a())}rbag(){return new p(this.ad,this.r(),this.b(),this.a(),this.g())}ragb(){return new p(this.ad,this.r(),this.a(),this.g(),this.b())}rabg(){return new p(this.ad,this.r(),this.a(),this.b(),this.g())}grba(){return new p(this.ad,this.g(),this.r(),this.b(),this.a())}grab(){return new p(this.ad,this.g(),this.r(),this.a(),this.b())}gbra(){return new p(this.ad,this.g(),this.b(),this.r(),this.a())}gbar(){return new p(this.ad,this.g(),this.b(),this.a(),this.r())}garb(){return new p(this.ad,this.g(),this.a(),this.r(),this.b())}gabr(){return new p(this.ad,this.g(),this.a(),this.b(),this.r())}brga(){return new p(this.ad,this.b(),this.r(),this.g(),this.a())}brag(){return new p(this.ad,this.b(),this.r(),this.a(),this.g())}bgra(){return new p(this.ad,this.b(),this.g(),this.r(),this.a())}bgar(){return new p(this.ad,this.b(),this.g(),this.a(),this.r())}barg(){return new p(this.ad,this.b(),this.a(),this.r(),this.g())}bagr(){return new p(this.ad,this.b(),this.a(),this.g(),this.r())}argb(){return new p(this.ad,this.a(),this.r(),this.g(),this.b())}arbg(){return new p(this.ad,this.a(),this.r(),this.b(),this.g())}agrb(){return new p(this.ad,this.a(),this.g(),this.r(),this.b())}agbr(){return new p(this.ad,this.a(),this.g(),this.b(),this.r())}abrg(){return new p(this.ad,this.a(),this.b(),this.r(),this.g())}abgr(){return new p(this.ad,this.a(),this.b(),this.g(),this.r())}rgb(){return new p(this.ad,this.r(),this.g(),this.b())}rbg(){return new p(this.ad,this.r(),this.b(),this.g())}grb(){return new p(this.ad,this.g(),this.r(),this.b())}gbr(){return new p(this.ad,this.g(),this.b(),this.r())}brg(){return new p(this.ad,this.b(),this.r(),this.g())}bgr(){return new p(this.ad,this.b(),this.g(),this.r())}rga(){return new p(this.ad,this.r(),this.g(),this.a())}rag(){return new p(this.ad,this.r(),this.a(),this.g())}gra(){return new p(this.ad,this.g(),this.r(),this.a())}gar(){return new p(this.ad,this.g(),this.a(),this.r())}arg(){return new p(this.ad,this.a(),this.r(),this.g())}agr(){return new p(this.ad,this.a(),this.g(),this.r())}rg(){return new p(this.ad,this.r(),this.g())}gr(){return new p(this.ad,this.g(),this.r())}rba(){return new p(this.ad,this.r(),this.b(),this.a())}rab(){return new p(this.ad,this.r(),this.a(),this.b())}bra(){return new p(this.ad,this.b(),this.r(),this.a())}bar(){return new p(this.ad,this.b(),this.a(),this.r())}arb(){return new p(this.ad,this.a(),this.r(),this.b())}abr(){return new p(this.ad,this.a(),this.b(),this.r())}rb(){return new p(this.ad,this.r(),this.b())}br(){return new p(this.ad,this.b(),this.r())}ra(){return new p(this.ad,this.r(),this.a())}ar(){return new p(this.ad,this.a(),this.r())}gba(){return new p(this.ad,this.g(),this.b(),this.a())}gab(){return new p(this.ad,this.g(),this.a(),this.b())}bga(){return new p(this.ad,this.b(),this.g(),this.a())}bag(){return new p(this.ad,this.b(),this.a(),this.g())}agb(){return new p(this.ad,this.a(),this.g(),this.b())}abg(){return new p(this.ad,this.a(),this.b(),this.g())}gb(){return new p(this.ad,this.g(),this.b())}bg(){return new p(this.ad,this.b(),this.g())}ga(){return new p(this.ad,this.g(),this.a())}ag(){return new p(this.ad,this.a(),this.g())}ba(){return new p(this.ad,this.b(),this.a())}ab(){return new p(this.ad,this.a(),this.b())}uv(){return new p(this.ad,this.u(),this.v())}vu(){return new p(this.ad,this.v(),this.u())}}n([h,r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",s.Op)],u.prototype,"x",null),n([h,r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",s.Op)],u.prototype,"y",null),n([h,r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",s.Op)],u.prototype,"z",null),n([h,r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",s.Op)],u.prototype,"w",null),e.VectorOp=u;class d extends u{get vecDependsOn(){return this.dependsOn}size(){return this.vecDependsOn[0].size()}}e.WithVecDependencies=d;class l extends s.Op{get vecDependsOn(){return this.dependsOn}size(){return this.vecDependsOn[0].size()}}e.ScalarWithVecDependencies=l,e.OffsetJacobian=class extends d{constructor(t,...e){super(t,...e),this.internalDerivatives.push({op:this.offset(),param:this.position().x()},{op:this.offset(),param:this.position().y()},{op:this.offset(),param:this.position().z()});for(const{op:t}of this.internalDerivatives)t.usedIn.push(this)}size(){return 3}position(){return this.dependsOn[0]}offset(){return this.dependsOn[1]}glslType(){return"mat3"}definition(){return`mat3(${this.offset().derivRef(this.position().x())},${this.offset().derivRef(this.position().y())},${this.offset().derivRef(this.position().z())})`}derivative(t){throw new Error("Unimplemented")}dot(t){return new c(this.ad,this,t)}};class c extends u{size(){return 3}mat3(){return this.dependsOn[0]}vec3(){return this.dependsOn[1]}definition(){return`${this.mat3().ref()}*${this.vec3().ref()}`}derivative(t){throw new Error("Unimplemented")}}e.Mat3Dot=c;class p extends u{size(){return this.dependsOn.length}definition(){return`vec${this.size()}(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){return`vec${this.size()}(${this.dependsOn.map((e=>e.derivRef(t))).join(",")})`}x(){return this.dependsOn[0]}y(){return this.dependsOn[1]}z(){return this.dependsOn[2]}w(){return this.dependsOn[3]}}e.Vec=p;class f extends u{constructor(t,e,i){super(t),this.name=e,this._size=i}size(){return this._size}x(){return new a(this.ad,"x",this)}y(){return new a(this.ad,"y",this)}z(){return new a(this.ad,"z",this)}w(){return new a(this.ad,"w",this)}getElems(){return"xyzw".split("").slice(0,this.size()).map((t=>this.getVecElementRef(t)))}definition(){return this.name}derivative(t){return`vec${this.size()}(${this.getElems().map((e=>e.derivRef(t))).join(",")})`}isConst(t){return!!t&&t!==this.x()&&t!==this.y()&&t!==this.z()}initializer(){return""}ref(){return this.definition()}derivInitializer(t){return this.isConst(t)||!this.useTempVar()?"":`vec${this.size()} ${this.derivRef(t)}=${this.derivative(t)};\n`}}n([h,r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",void 0)],f.prototype,"x",null),n([h,r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",void 0)],f.prototype,"y",null),n([h,r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",void 0)],f.prototype,"z",null),n([h,r("design:type",Function),r("design:paramtypes",[]),r("design:returntype",void 0)],f.prototype,"w",null),e.VecParam=f,e.WithVecBase=function(t){return class extends t{constructor(){super(...arguments),this.vec2Param=s.UserInput((function(t){return new f(this,t,2)})),this.vec3Param=s.UserInput((function(t){return new f(this,t,3)})),this.vec4Param=s.UserInput((function(t){return new f(this,t,4)})),this.vec2=s.UserInput((function(t,e){return new p(this,this.convertVal(t),this.convertVal(e))})),this.vec3=s.UserInput((function(t,e,i){return new p(this,...this.convertVals([t,e,i]))})),this.vec4=s.UserInput((function(t,e,i,n){return new p(this,...this.convertVals([t,e,i,n]))}))}}}},35:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WithVecFunctions=e.Normalize=e.Cross=e.Dist=e.Length=e.Dot=e.VecAbs=e.VecNormalize=e.VecIfElse=e.VecMax=e.VecMin=e.VecClamp=e.VecMix=void 0;const n=i(433),r=i(789),s=i(165);class o extends r.WithVecDependencies{definition(){return`mix(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i,n]=this.dependsOn;return`(1.0-${e.ref()})*${n.derivRef(t)}+(-${e.derivRef(t)})*${n.ref()}+${i.ref()}*${n.derivRef(t)}+${i.derivRef(t)}*${n.ref()}`}}e.VecMix=o;class a extends r.WithVecDependencies{definition(){return`clamp(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i,n]=this.vecDependsOn.map((t=>"xyzw".split("").slice(0,t.size()).map((e=>t.getVecElementRef(e))))),r=Array(this.size()).fill(0).map(((r,s)=>{return o=e[s],a=i[s],h=n[s],`${o.ref()}<${a.ref()} ? 0.0 : (${o.ref()}>${h.ref()} ? 0.0 : ${o.derivRef(t)})`;var o,a,h})).join(",");return`vec${this.size()}(${r})`}}e.VecClamp=a;class h extends r.WithVecDependencies{definition(){return`min(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i]=this.vecDependsOn.map((t=>"xyzw".split("").slice(0,t.size()).map((e=>t.getVecElementRef(e))))),n=Array(this.size()).fill(0).map(((n,r)=>{return s=e[r],o=i[r],`${s.ref()}<${o.ref()} ? ${s.derivRef(t)} : ${o.derivRef(t)}`;var s,o})).join(",");return`vec${this.size()}(${n})`}}e.VecMin=h;class u extends r.WithVecDependencies{definition(){return`max(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i]=this.vecDependsOn.map((t=>"xyzw".split("").slice(0,t.size()).map((e=>t.getVecElementRef(e))))),n=Array(this.size()).fill(0).map(((n,r)=>{return s=e[r],o=i[r],`${s.ref()}>${o.ref()} ? ${s.derivRef(t)} : ${o.derivRef(t)}`;var s,o})).join(",");return`vec${this.size()}(${n})`}}e.VecMax=u;class d extends r.WithVecDependencies{size(){return this.vecDependsOn[1].size()}definition(){const[t,e,i]=this.dependsOn;return`${t.ref()}?${e.ref()}:${i.ref()}`}derivative(t){const[e,i,n]=this.dependsOn;return`${e.ref()}?${i.derivRef(t)}:${n.derivRef(t)}`}}e.VecIfElse=d;class l extends r.WithVecDependencies{size(){return this.vecDependsOn[0].size()}definition(){const[t]=this.dependsOn;return`normalize(${t.ref()})`}derivative(t){throw new Error("unimplemented")}}e.VecNormalize=l;class c extends r.WithVecDependencies{size(){return this.vecDependsOn[0].size()}definition(){const[t]=this.dependsOn;return`abs(${t.ref()})}`}derivative(t){return"0.0"}}e.VecAbs=c;class p extends r.ScalarWithVecDependencies{definition(){return`dot(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){const[e,i]=this.vecDependsOn;return"xyzw".split("").slice(0,this.size()).map((n=>`${e.ref()}.${n}*${i.derivRef(t)}.${n}+${i.ref()}.${n}*${e.derivRef(t)}.${n}`)).join("+")}}e.Dot=p;class f extends r.ScalarWithVecDependencies{scalar(){return!0}definition(){return`length(${this.dependsOn[0].ref()})`}derivative(t){return`0.5/length(${this.dependsOn[0].ref()})*${"xyzw".split("").slice(0,this.size()).map((e=>`2.0*${this.dependsOn[0].ref()}.${e}*${this.dependsOn[0].derivRef(t)}.${e}`)).join("+")}`}}e.Length=f;class v extends r.ScalarWithVecDependencies{definition(){return`distance(${this.dependsOn.map((t=>t.ref())).join(",")})`}derivative(t){return`0.5/distance(${this.dependsOn.map((t=>t.ref())).join(",")})*${"xyzw".split("").slice(0,this.size()).map((e=>`2.0*(${this.dependsOn.map((t=>t.ref())).join("-")}).${e}*(${this.dependsOn.map((e=>e.derivRef(t))).join("-")}).${e}`)).join("+")}`}}e.Dist=v;class m extends r.WithVecDependencies{size(){return this.vecDependsOn[0].size()}definition(){const[t,e]=this.dependsOn;return`cross(${t.ref()},${e.ref()})`}derivative(t){throw new Error("unimplemented")}}e.Cross=m;class w extends r.WithVecDependencies{size(){return this.vecDependsOn[0].size()}definition(){const[t,e]=this.dependsOn;return`normalize(${t.ref()}})`}derivative(t){throw new Error("unimplemented")}}e.Normalize=w,r.VectorOp.prototype.mix=n.UserInput((function(t,e){return new o(this.ad,this,t,this.ad.convertVal(e))})),r.VectorOp.prototype.clamp=n.UserInput((function(t,e){return new a(this.ad,this,t,e)})),r.VectorOp.prototype.min=n.UserInput((function(...t){return t.reduce(((t,e)=>new h(this.ad,t,e)),this)})),r.VectorOp.prototype.max=n.UserInput((function(...t){return t.reduce(((t,e)=>new u(this.ad,t,e)),this)})),r.VectorOp.prototype.dot=n.UserInput((function(t){return new p(this.ad,this,t)})),r.VectorOp.prototype.length=n.UserInput((function(){return new f(this.ad,this)})),r.VectorOp.prototype.dist=n.UserInput((function(t){return new v(this.ad,this,t)})),n.Op.prototype.vecIfElse=n.UserInput((function(t,e){return new d(this.ad,this,t,e)})),r.VectorOp.prototype.adjustNormal=function(t,e){const i=new r.Vec(this.ad,...this.ad.convertVals([1,0,0])),o=new r.Vec(this.ad,...this.ad.convertVals([0,1,0])),a=new n.EqOp(this.ad,t.y(),new n.Value(this.ad,0)),h=new n.EqOp(this.ad,t.z(),new n.Value(this.ad,0)),u=new n.AndOp(this.ad,a,h).vecIfElse(o,i),d=new l(this.ad,new m(this.ad,u,t)),c=new m(this.ad,d,t),p=new r.OffsetJacobian(this.ad,e,this),f=new s.VecMult(this.ad,p,c),v=new s.VecMult(this.ad,p,d);return new l(this.ad,new m(this.ad,new s.VecSum(this.ad,c,f),new s.VecSum(this.ad,d,v)))},e.WithVecFunctions=function(t){return class extends t{constructor(){super(...arguments),this.vecMix=n.UserInput((function(t,e,i){return t.mix(e,i)})),this.vecClamp=n.UserInput((function(t,e,i){return t.clamp(e,i)})),this.vecMin=n.UserInput((function(...t){if(0===t.length)throw new Error("No arguments passed to vecMin()!");return t.reduce(((t,e)=>t.min(e)))})),this.vecMax=n.UserInput((function(...t){if(0===t.length)throw new Error("No arguments passed to vecMax()!");return t.reduce(((t,e)=>t.max(e)))})),this.dot=n.UserInput((function(t,e){return t.dot(e)})),this.length=n.UserInput((function(t){return t.length()})),this.dist=n.UserInput((function(t,e){return t.dist(e)}))}}}}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var s=e[n]={exports:{}};return t[n].call(s.exports,s,s.exports,i),s.exports}var n={};return(()=>{var t=n;Object.defineProperty(t,"__esModule",{value:!0}),t.gen=void 0;const e=i(433),r=i(888),s=i(225),o=i(789),a=i(165),h=i(35).WithVecFunctions(a.WithVecArithmetic(o.WithVecBase(s.WithFunctions(r.WithArithmetic(class{constructor(){this.nextID=0,this.settings={maxDepthPerVariable:8,debug:!1},this.params={},this.outputs={},this.derivOutputs={},this.val=e.UserInput((function(t){return new e.Value(this,t)})),this.param=e.UserInput((function(t){return new e.Param(this,t)}))}getNextID(){const t=this.nextID;return this.nextID++,t}registerParam(t,e){this.params[e]=t}convertVal(t){return t instanceof e.Op?t:this.val(t)}convertVals(t){return t.map((t=>this.convertVal(t)))}output(t,e){return this.outputs[t]=e,this}outputDeriv(t,e,i){const n="string"==typeof e?e:e.name;return this.derivOutputs[n]=this.derivOutputs[n]||{},this.derivOutputs[n][t]=i,this}gen(){var t;let e="";const i=new Set,n=new Map;for(const t in this.outputs)e+=this.outputs[t].outputDependencies({deps:i,derivDeps:n}),e+=this.outputs[t].initializer(),i.add(this.outputs[t]),e+=`${this.outputs[t].glslType()} ${t}=${this.outputs[t].ref()};\n`;for(const r in this.derivOutputs){const s=this.params[r];for(const o in this.derivOutputs[r]){e+=this.derivOutputs[r][o].outputDerivDependencies(s,{deps:i,derivDeps:n}),e+=this.derivOutputs[r][o].derivInitializer(s),e+=`${this.derivOutputs[r][o].glslType()} ${o}=${this.derivOutputs[r][o].derivRef(s)};\n`;const a=null!==(t=n.get(s))&&void 0!==t?t:new Set;a.add(this.derivOutputs[r][o]),n.set(s,a)}}return e}})))));t.gen=(t,e={})=>{const i=new h;for(const t in e)i.settings[t]=e[t];return t(i),i.gen()}})(),n})()},262:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setupWarp=void 0;const n=i(715),r=function(t,{type:e="specular",space:i="local"}={}){const r=this,o="\n#ifdef WEBGL2\n\n#define IN in\n#define OUT out\n\n#ifdef FRAGMENT_SHADER\nout vec4 outColor;\n#define OUT_COLOR outColor\n#endif\n#define TEXTURE texture\n\n#else\n\n#ifdef FRAGMENT_SHADER\n#define IN varying\n#else\n#define IN attribute\n#endif\n#define OUT varying\n#define TEXTURE texture2D\n\n#ifdef FRAGMENT_SHADER\n#define OUT_COLOR gl_FragColor\n#endif\n\n#endif",a=`${s(this,"vert","highp")}\n${o}\nprecision highp int;\n\nIN vec3 aPosition;\nIN vec3 aNormal;\nIN vec2 aTexCoord;\nIN vec4 aVertexColor;\n\nuniform vec3 uAmbientColor[5];\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\nuniform mat3 uNormalMatrix;\nuniform int uAmbientLightCount;\n\nuniform bool uUseVertexColor;\nuniform vec4 uMaterialColor;\n\nOUT vec3 vNormal;\nOUT vec2 vTexCoord;\nOUT vec3 vViewPosition;\nOUT vec3 vAmbientColor;\nOUT vec4 vColor;\n\nuniform vec2 mouse;\nuniform float millis;\nuniform float pixelDensity;\nuniform vec2 size;\n\nvoid main(void) {\n  vColor = (uUseVertexColor ? aVertexColor : uMaterialColor);\n\n  ${"world"===i?"vec3 world = (uModelViewMatrix * vec4(aPosition, 1.0)).xyz;":""}\n  ${"world"===i?"vec3 worldNormal = uNormalMatrix * aNormal;":""}\n\n  ${(0,n.gen)((e=>{const n=e.vec3Param("world"===i?"world":"aPosition"),r=e.param("millis"),s=e.vec2Param("mouse"),o=s.x(),a=s.y(),h=e.param("pixelDensity"),u=e.vec2Param("size"),d=u.x(),l=u.y(),c=e.vec2Param("aTexCoord"),p=e.vec2Param("world"===i?"worldNormal":"aNormal"),f=e.vec4Param("vColor"),v=t({glsl:e,position:n,millis:r,mouse:s,mouseX:o,mouseY:a,pixelDensity:h,size:u,width:d,height:l,uv:c,normal:p,color:f});v.output("offset"),v.adjustNormal(p,n).output("adjustedNormal")}))}\n\n  vec4 viewModelPosition = ${"world"===i?"vec4(world + offset, 1.0)":"uModelViewMatrix * vec4(aPosition + offset, 1.0)"};\n\n  // Pass varyings to fragment shader\n  vViewPosition = viewModelPosition.xyz;\n  gl_Position = uProjectionMatrix * viewModelPosition;  \n\n  vNormal = ${"world"===i?"":"uNormalMatrix *"} adjustedNormal;\n  vTexCoord = aTexCoord;\n\n  // TODO: this should be a uniform\n  vAmbientColor = vec3(0.0);\n  for (int i = 0; i < 5; i++) {\n    if (i < uAmbientLightCount) {\n      vAmbientColor += uAmbientColor[i];\n    }\n  }\n}`,h=`${s(this,"frag","highp")}\n${o}\n#define PI 3.141592\nprecision highp int;\n\nuniform bool normalMaterial;\n\nuniform vec4 uSpecularMatColor;\nuniform vec4 uAmbientMatColor;\nuniform vec4 uEmissiveMatColor;\n\nuniform vec4 uTint;\nuniform sampler2D uSampler;\nuniform bool isTexture;\nuniform bool uHasSetAmbient;\n\nIN vec3 vNormal;\nIN vec2 vTexCoord;\nIN vec3 vViewPosition;\nIN vec3 vAmbientColor;\nIN vec4 vColor;\n\nuniform mat4 uViewMatrix;\n\nuniform bool uUseLighting;\n\nuniform int uAmbientLightCount;\nuniform vec3 uAmbientColor[5];\n\nuniform int uDirectionalLightCount;\nuniform vec3 uLightingDirection[5];\nuniform vec3 uDirectionalDiffuseColors[5];\nuniform vec3 uDirectionalSpecularColors[5];\n\nuniform int uPointLightCount;\nuniform vec3 uPointLightLocation[5];\nuniform vec3 uPointLightDiffuseColors[5];\t\nuniform vec3 uPointLightSpecularColors[5];\n\nuniform int uSpotLightCount;\nuniform float uSpotLightAngle[5];\nuniform float uSpotLightConc[5];\nuniform vec3 uSpotLightDiffuseColors[5];\nuniform vec3 uSpotLightSpecularColors[5];\nuniform vec3 uSpotLightLocation[5];\nuniform vec3 uSpotLightDirection[5];\n\nuniform bool uSpecular;\nuniform float uShininess;\n\nuniform float uConstantAttenuation;\nuniform float uLinearAttenuation;\nuniform float uQuadraticAttenuation;\n\n// setting from  _setImageLightUniforms()\n// boolean to initiate the calculateImageDiffuse and calculateImageSpecular\nuniform bool uUseImageLight;\n// texture for use in calculateImageDiffuse\nuniform sampler2D environmentMapDiffused;\n// texture for use in calculateImageSpecular\nuniform sampler2D environmentMapSpecular;\n// roughness for use in calculateImageSpecular\nuniform float levelOfDetail;\n\nconst float specularFactor = 2.0;\nconst float diffuseFactor = 0.73;\n\nstruct LightResult {\n  float specular;\n  float diffuse;\n};\n\nfloat _phongSpecular(\n  vec3 lightDirection,\n  vec3 viewDirection,\n  vec3 surfaceNormal,\n  float shininess) {\n\n  vec3 R = reflect(lightDirection, surfaceNormal);\n  return pow(max(0.0, dot(R, viewDirection)), shininess);\n}\n\nfloat _lambertDiffuse(vec3 lightDirection, vec3 surfaceNormal) {\n  return max(0.0, dot(-lightDirection, surfaceNormal));\n}\n\nLightResult _light(vec3 viewDirection, vec3 normal, vec3 lightVector) {\n\n  vec3 lightDir = normalize(lightVector);\n\n  //compute our diffuse & specular terms\n  LightResult lr;\n  if (uSpecular)\n    lr.specular = _phongSpecular(lightDir, viewDirection, normal, uShininess);\n  lr.diffuse = _lambertDiffuse(lightDir, normal);\n  return lr;\n}\n\n// converts the range of "value" from [min1 to max1] to [min2 to max2]\nfloat map(float value, float min1, float max1, float min2, float max2) {\n  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);\n}\n\nvec2 mapTextureToNormal( vec3 v ){\n  // x = r sin(phi) cos(theta)   \n  // y = r cos(phi)  \n  // z = r sin(phi) sin(theta)\n  float phi = acos( v.y );\n  // if phi is 0, then there are no x, z components\n  float theta = 0.0;\n  // else \n  theta = acos(v.x / sin(phi));\n  float sinTheta = v.z / sin(phi);\n  if (sinTheta < 0.0) {\n    // Turn it into -theta, but in the 0-2PI range\n    theta = 2.0 * PI - theta;\n  }\n  theta = theta / (2.0 * 3.14159);\n  phi = phi / 3.14159 ;\n  \n  vec2 angles = vec2( fract(theta + 0.25), 1.0 - phi );\n  return angles;\n}\n\n\nvec3 calculateImageDiffuse( vec3 vNormal, vec3 vViewPosition ){\n  // make 2 seperate builds \n  vec3 worldCameraPosition =  vec3(0.0, 0.0, 0.0);  // hardcoded world camera position\n  vec3 worldNormal = normalize(vNormal);\n  vec2 newTexCoor = mapTextureToNormal( worldNormal );\n  vec4 texture = TEXTURE( environmentMapDiffused, newTexCoor );\n  // this is to make the darker sections more dark\n  // png and jpg usually flatten the brightness so it is to reverse that\n  return smoothstep(vec3(0.0), vec3(0.8), texture.xyz);\n}\n\nvec3 calculateImageSpecular( vec3 vNormal, vec3 vViewPosition ){\n  vec3 worldCameraPosition =  vec3(0.0, 0.0, 0.0);\n  vec3 worldNormal = normalize(vNormal);\n  vec3 lightDirection = normalize( vViewPosition - worldCameraPosition );\n  vec3 R = reflect(lightDirection, worldNormal);\n  vec2 newTexCoor = mapTextureToNormal( R );\n#ifdef WEBGL2\n  vec4 outColor = textureLod(environmentMapSpecular, newTexCoor, levelOfDetail);\n#else\n  vec4 outColor = TEXTURE(environmentMapSpecular, newTexCoor);\n#endif\n  // this is to make the darker sections more dark\n  // png and jpg usually flatten the brightness so it is to reverse that\n  return pow(outColor.xyz, vec3(10.0));\n}\n\nvoid totalLight(\n  vec3 modelPosition,\n  vec3 normal,\n  out vec3 totalDiffuse,\n  out vec3 totalSpecular\n) {\n\n  totalSpecular = vec3(0.0);\n\n  if (!uUseLighting) {\n    totalDiffuse = vec3(1.0);\n    return;\n  }\n\n  totalDiffuse = vec3(0.0);\n\n  vec3 viewDirection = normalize(-modelPosition);\n\n  for (int j = 0; j < 5; j++) {\n    if (j < uDirectionalLightCount) {\n      vec3 lightVector = (uViewMatrix * vec4(uLightingDirection[j], 0.0)).xyz;\n      vec3 lightColor = uDirectionalDiffuseColors[j];\n      vec3 specularColor = uDirectionalSpecularColors[j];\n      LightResult result = _light(viewDirection, normal, lightVector);\n      totalDiffuse += result.diffuse * lightColor;\n      totalSpecular += result.specular * lightColor * specularColor;\n    }\n\n    if (j < uPointLightCount) {\n      vec3 lightPosition = (uViewMatrix * vec4(uPointLightLocation[j], 1.0)).xyz;\n      vec3 lightVector = modelPosition - lightPosition;\n    \n      //calculate attenuation\n      float lightDistance = length(lightVector);\n      float lightFalloff = 1.0 / (uConstantAttenuation + lightDistance * uLinearAttenuation + (lightDistance * lightDistance) * uQuadraticAttenuation);\n      vec3 lightColor = lightFalloff * uPointLightDiffuseColors[j];\n      vec3 specularColor = lightFalloff * uPointLightSpecularColors[j];\n\n      LightResult result = _light(viewDirection, normal, lightVector);\n      totalDiffuse += result.diffuse * lightColor;\n      totalSpecular += result.specular * lightColor * specularColor;\n    }\n\n    if(j < uSpotLightCount) {\n      vec3 lightPosition = (uViewMatrix * vec4(uSpotLightLocation[j], 1.0)).xyz;\n      vec3 lightVector = modelPosition - lightPosition;\n    \n      float lightDistance = length(lightVector);\n      float lightFalloff = 1.0 / (uConstantAttenuation + lightDistance * uLinearAttenuation + (lightDistance * lightDistance) * uQuadraticAttenuation);\n\n      vec3 lightDirection = (uViewMatrix * vec4(uSpotLightDirection[j], 0.0)).xyz;\n      float spotDot = dot(normalize(lightVector), normalize(lightDirection));\n      float spotFalloff;\n      if(spotDot < uSpotLightAngle[j]) {\n        spotFalloff = 0.0;\n      }\n      else {\n        spotFalloff = pow(spotDot, uSpotLightConc[j]);\n      }\n      lightFalloff *= spotFalloff;\n\n      vec3 lightColor = uSpotLightDiffuseColors[j];\n      vec3 specularColor = uSpotLightSpecularColors[j];\n     \n      LightResult result = _light(viewDirection, normal, lightVector);\n      \n      totalDiffuse += result.diffuse * lightColor * lightFalloff;\n      totalSpecular += result.specular * lightColor * specularColor * lightFalloff;\n    }\n  }\n\n  if( uUseImageLight ){\n    totalDiffuse += calculateImageDiffuse(normal, modelPosition);\n    totalSpecular += calculateImageSpecular(normal, modelPosition);\n  }\n\n  totalDiffuse *= diffuseFactor;\n  totalSpecular *= specularFactor;\n}\n\nvoid main(void) {\n  if (normalMaterial) {\n    OUT_COLOR = vec4(abs(normalize(vNormal)), 1.0);\n    return;\n  }\n\n  vec3 diffuse;\n  vec3 specular;\n  totalLight(vViewPosition, normalize(vNormal), diffuse, specular);\n\n  // Calculating final color as result of all lights (plus emissive term).\n\n  vec4 baseColor = isTexture\n    // Textures come in with premultiplied alpha. To apply tint and still have\n    // premultiplied alpha output, we need to multiply the RGB channels by the\n    // tint RGB, and all channels by the tint alpha.\n    ? TEXTURE(uSampler, vTexCoord) * vec4(uTint.rgb/255., 1.) * (uTint.a/255.)\n    // Colors come in with unmultiplied alpha, so we need to multiply the RGB\n    // channels by alpha to convert it to premultiplied alpha.\n    : vec4(vColor.rgb * vColor.a, vColor.a);\n  OUT_COLOR = vec4(diffuse * baseColor.rgb + \n                    vAmbientColor * (\n                      uHasSetAmbient ? uAmbientMatColor.rgb : baseColor.rgb\n                    ) + \n                    specular * uSpecularMatColor.rgb + \n                    uEmissiveMatColor.rgb, baseColor.a);\n}`,u=this.createShader(a,h);return()=>{r.shader(u),u.setUniform("mouse",[r.mouseX,r.mouseY]),u.setUniform("millis",r.millis()),u.setUniform("pixelDensity",r.pixelDensity()),u.setUniform("size",[r.width,r.height]),u.setUniform("normalMaterial","normal"===e),r.noStroke()}};function s(t,e,i){let n="";return t.webglVersion===t.WEBGL2&&(n+="#version 300 es\n#define WEBGL2\n"),"vert"===e?n+="#define VERTEX_SHADER\n":"frag"===e&&(n+="#define FRAGMENT_SHADER\n"),i&&(n+=`precision ${i} float;\n`),n}e.setupWarp=t=>{t.prototype.createWarp=r,t.Graphics.prototype.createWarp=r},window.p5&&(0,e.setupWarp)(p5)}},e={},function i(n){var r=e[n];if(void 0!==r)return r.exports;var s=e[n]={exports:{}};return t[n](s,s.exports,i),s.exports}(262);var t,e}));